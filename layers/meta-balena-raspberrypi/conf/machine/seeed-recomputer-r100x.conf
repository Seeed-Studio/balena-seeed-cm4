#@TYPE: Machine
#@NAME: Seeed reComputer-R100x
#@SOC: broadcom bcm2711
#@DESCRIPTION: Machine configuration for seeed reComputer-R100x
#@MAINTAINER: ruiqian tang <ruiqian.tang@seeed.cc>

MACHINEOVERRIDES = "raspberrypi4-64:${MACHINE}"
include conf/machine/raspberrypi4-64.conf

# Ensure correct kernel image type for aarch64
KERNEL_IMAGETYPE = "Image"

# Increase initramfs maxsize to 40 MiB for this device
IMAGE_ROOTFS_MAXSIZE = "40960"

IMAGE_INSTALL:append = " userlandtools"

RPI_KERNEL_DEVICETREE_OVERLAYS:append = " overlays/i2c0.dtbo \ 
overlays/i2c1.dtbo overlays/i2c3.dtbo overlays/i2c6.dtbo"

# Add device tree overlays from seeed-linux-dtoverlays package to boot partition
BALENA_BOOT_PARTITION_FILES:append = " reComputer-R100x-1.1.dtbo:/overlays/reComputer-R100x-1.1.dtbo"
KERNEL_MODULE_AUTOLOAD:rpi += "i2c-dev"
MACHINE_ESSENTIAL_EXTRA_RRECOMMENDS += "seeed-linux-dtoverlays"

# Ensure seeed-linux-dtoverlays is deployed before balena-image build
do_resin_boot_dirgen_and_deploy[depends] += "seeed-linux-dtoverlays:do_deploy"
ENABLE_I2C = "1"
ENABLE_UART = "1"